<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</title>
    <style>
        :root {
            --bg-color: #0a1a2a;
            --text-color: #e0e0e0;
            --blue-accent: #4285F4;
            --white: #ffffff;
            --menu-btn: rgba(66, 133, 244, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            transition: all 0.2s;
        }

        body {
            background-color: var(--bg-color);
            background-image: url(static/background.png);
            color: var(--text-color);
            padding: 16px;
            max-width: 100%;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ */
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            width: 100%;
            max-width: 1200px;
        }

        .page-title {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
        }

        .back-button {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 32px;
            cursor: pointer;
            padding: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }

        .menu-button {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            align-self: center;
            z-index: 1;
        }

        .menu-line {
            width: 24px;
            height: 3px;
            background-color: var(--text-color);
            border-radius: 2px;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            right: 16px;
            top: 60px;
            background-color: #0f2233;
            border-radius: 12px;
            padding: 8px 0;
            min-width: 220px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 10;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            color: var(--text-color);
            border-radius: 0;
            transition: background-color 0.2s;
        }

        .dropdown-item:hover {
            background-color: rgba(66, 133, 244, 0.2);
        }

        .dropdown-icon {
            margin-right: 12px;
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        .dropdown-divider {
            height: 1px;
            background-color: rgba(255, 255, 255, 0.1);
            margin: 8px 0;
        }

        .logout-item {
            color: #EA4335;
        }

        .history-container {
            width: 100%;
            max-width: 600px;
            margin-top: 20px;
        }

        .filter-container {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .filter-button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 8px 16px;
            color: var(--text-color);
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .filter-button.active {
            background: var(--blue-accent);
            border-color: var(--blue-accent);
        }

        .transaction-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .transaction-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .transaction-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .transaction-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .transaction-type {
            font-size: 16px;
            font-weight: 500;
        }

        .transaction-date {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
        }

        .transaction-amount {
            font-size: 18px;
            font-weight: 600;
        }

        .amount-positive {
            color: #34A853;
        }

        .amount-negative {
            color: #EA4335;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.6);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-state-text {
            font-size: 16px;
            line-height: 1.5;
        }

        .load-more {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            padding: 12px;
            color: var(--text-color);
            font-size: 16px;
            margin-top: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .load-more:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .transaction-status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            margin-top: 4px;
        }

        .status-completed {
            background: rgba(52, 168, 83, 0.2);
            color: #34A853;
        }

        .status-pending {
            background: rgba(255, 152, 0, 0.2);
            color: #FFA000;
        }

        .status-failed {
            background: rgba(234, 67, 53, 0.2);
            color: #EA4335;
        }
    </style>
</head>
<body>
    <div class="header">
        <button class="back-button" onclick="goBack()">‚Üê</button>
        <div class="page-title">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</div>
        <button class="menu-button" onclick="toggleDropdown()">
            <div class="menu-line"></div>
            <div class="menu-line"></div>
            <div class="menu-line"></div>
        </button>
    </div>

    <div class="dropdown-menu" id="dropdownMenu">
        <div class="dropdown-item" onclick="openPage('rules')">
            <span class="dropdown-icon">üìú</span>
            –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã
        </div>
        <div class="dropdown-item" onclick="openPage('profile')">
            <span class="dropdown-icon">üë§</span>
            –ü—Ä–æ—Ñ–∏–ª—å –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        </div>
        <div class="dropdown-item" onclick="openPage('bonus')">
            <span class="dropdown-icon">üéÅ</span>
            –ë–æ–Ω—É—Å—ã –∏ –∞–∫—Ü–∏–∏
        </div>

        <div class="dropdown-item" onclick="openPage('invite')">
            <span class="dropdown-icon">üë•</span>
            –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞
        </div>
        <div class="dropdown-divider"></div>
        <div class="dropdown-item logout-item" onclick="logout()">
            <span class="dropdown-icon">üö™</span>
            –í—ã–π—Ç–∏
        </div>
    </div>

    <div class="history-container">
        <div class="filter-container">
            <button class="filter-button active" onclick="filterTransactions('all')">–í—Å–µ</button>
            <button class="filter-button" onclick="filterTransactions('deposit')">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏—è</button>
            <button class="filter-button" onclick="filterTransactions('withdraw')">–í—ã–≤–æ–¥—ã</button>
            <button class="filter-button" onclick="filterTransactions('transfer')">–ü–µ—Ä–µ–≤–æ–¥—ã</button>
            <button class="filter-button" onclick="filterTransactions('bonus')">–ë–æ–Ω—É—Å—ã</button>
        </div>

        <div class="transaction-list" id="transactionList">
            <!-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>

        <button class="load-more" onclick="loadMoreTransactions()" id="loadMoreButton" style="display: none;">
            –ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ
        </button>
    </div>

    <script src="static/js/telegram-utils.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram WebApp
            if (!TelegramUtils.init()) {
                TelegramUtils.showAlert('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
                return;
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            loadTransactions();
        });

        let currentPage = 1;
        let currentFilter = 'all';
        let isLoading = false;

        // –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞)
        const mockTransactions = [
            {
                id: 1,
                type: 'deposit',
                amount: 1000,
                date: '2024-03-20T10:30:00',
                status: 'completed',
                description: '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞'
            },
            {
                id: 2,
                type: 'withdraw',
                amount: -500,
                date: '2024-03-19T15:45:00',
                status: 'pending',
                description: '–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤'
            },
            {
                id: 3,
                type: 'transfer',
                amount: -200,
                date: '2024-03-18T12:20:00',
                status: 'completed',
                description: '–ü–µ—Ä–µ–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é @user123'
            },
            {
                id: 4,
                type: 'bonus',
                amount: 100,
                date: '2024-03-17T09:15:00',
                status: 'completed',
                description: '–ë–æ–Ω—É—Å –∑–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–≥–∞'
            }
        ];

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatAmount(amount) {
            return `${amount > 0 ? '+' : ''}${amount.toFixed(2)} ‚ÇΩ`;
        }

        function getStatusClass(status) {
            switch (status) {
                case 'completed': return 'status-completed';
                case 'pending': return 'status-pending';
                case 'failed': return 'status-failed';
                default: return '';
            }
        }

        function getStatusText(status) {
            switch (status) {
                case 'completed': return '–í—ã–ø–æ–ª–Ω–µ–Ω–æ';
                case 'pending': return '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ';
                case 'failed': return '–û—à–∏–±–∫–∞';
                default: return status;
            }
        }

        function createTransactionElement(transaction) {
            const div = document.createElement('div');
            div.className = 'transaction-item';
            div.innerHTML = `
                <div class="transaction-info">
                    <div class="transaction-type">${transaction.description}</div>
                    <div class="transaction-date">${formatDate(transaction.date)}</div>
                    <div class="transaction-status ${getStatusClass(transaction.status)}">
                        ${getStatusText(transaction.status)}
                    </div>
                </div>
                <div class="transaction-amount ${transaction.amount > 0 ? 'amount-positive' : 'amount-negative'}">
                    ${formatAmount(transaction.amount)}
                </div>
            `;
            return div;
        }

        function loadTransactions() {
            if (isLoading) return;
            isLoading = true;

            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API
            setTimeout(() => {
                const transactionList = document.getElementById('transactionList');
                
                if (currentPage === 1) {
                    transactionList.innerHTML = '';
                }

                const filteredTransactions = mockTransactions.filter(t => 
                    currentFilter === 'all' || t.type === currentFilter
                );

                if (filteredTransactions.length === 0 && currentPage === 1) {
                    transactionList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìä</div>
                            <div class="empty-state-text">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø—É—Å—Ç–∞</div>
                        </div>
                    `;
                } else {
                    filteredTransactions.forEach(transaction => {
                        transactionList.appendChild(createTransactionElement(transaction));
                    });
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ" –µ—Å–ª–∏ –µ—Å—Ç—å –µ—â–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                document.getElementById('loadMoreButton').style.display = 
                    filteredTransactions.length >= 10 ? 'block' : 'none';

                isLoading = false;
            }, 500);
        }

        function loadMoreTransactions() {
            currentPage++;
            loadTransactions();
            TelegramUtils.hapticFeedback('light');
        }

        function filterTransactions(filter) {
            currentFilter = filter;
            currentPage = 1;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É —Ñ–∏–ª—å—Ç—Ä–∞
            document.querySelectorAll('.filter-button').forEach(button => {
                button.classList.remove('active');
                if (button.textContent.toLowerCase().includes(filter)) {
                    button.classList.add('active');
                }
            });

            loadTransactions();
            TelegramUtils.hapticFeedback('light');
        }

        function openPage(page) {
            TelegramUtils.openLink(page);
        }

        function goBack() {
            TelegramUtils.closeWebApp();
        }

        function toggleDropdown() {
            const dropdown = document.getElementById('dropdownMenu');
            dropdown.classList.toggle('show');
        }

        window.onclick = function(event) {
            if (!event.target.matches('.menu-button') && !event.target.matches('.menu-line')) {
                const dropdowns = document.getElementsByClassName("dropdown-menu");
                for (let i = 0; i < dropdowns.length; i++) {
                    const openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }

        function logout() {
            TelegramUtils.showConfirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?', (confirmed) => {
                if (confirmed) {
                    TelegramUtils.closeWebApp();
                }
            });
        }
    </script>
</body>
</html>