<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–µ–∫–∞ | Telegram Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --primary-color: #0088cc;
            --border-color: #e0e0e0;
            --cell-bg: #f5f5f5;
        }

        body.dark {
            --bg-color: #212121;
            --text-color: #ffffff;
            --primary-color: #2b5278;
            --border-color: #424242;
            --cell-bg: #303030;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 16px;
            text-align: center;
            transition: all 0.3s ease;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 24px;
        }

        #mainMenu {
            display: block;
        }

        #gameScreen {
            display: none;
        }

        .play-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 16px 32px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            width: 80%;
            max-width: 4000px;
            margin: 0 auto;
        }

        .play-btn:active {
            transform: scale(0.95);
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
            margin: 20px auto;
            max-width: 300px;
        }

        .cell {
            aspect-ratio: 1;
            background-color: var(--cell-bg);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s;
        }

        .cell.revealed {
            background-color: rgba(0, 136, 204, 0.1);
        }

        .cell.bomb {
            background-color: #ff4444;
            color: white;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .back-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            margin-top: 20px;
            cursor: pointer;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="mainMenu">
            <h1>–°–µ–∫–∞</h1>
            <button class="play-btn" id="playBtn">–ò–≥—Ä–∞—Ç—å</button>
        </div>

        <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
        <div id="gameScreen">
            <div class="stats">
                <div>–§–ª–∞–≥–∏: <span id="flags">0</span></div>
                <div>–í—Ä–µ–º—è: <span id="timer">0</span>—Å</div>
            </div>
            <div class="game-board" id="board"></div>
            <button class="back-btn" id="backBtn">‚Üê –ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã
        function updateTheme() {
            document.body.classList.toggle('dark', tg.colorScheme === 'dark');
        }
        tg.onEvent('themeChanged', updateTheme);
        updateTheme();

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const playBtn = document.getElementById('playBtn');
        const backBtn = document.getElementById('backBtn');
        const mainMenu = document.getElementById('mainMenu');
        const gameScreen = document.getElementById('gameScreen');
        const boardEl = document.getElementById('board');
        const flagsEl = document.getElementById('flags');
        const timerEl = document.getElementById('timer');

        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        const BOARD_SIZE = 5;
        const BOMBS_COUNT = 5;
        let board = [];
        let flags = 0;
        let seconds = 0;
        let timer = null;
        let gameActive = false;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            // –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ
            board = Array(BOARD_SIZE).fill().map(() => 
                Array(BOARD_SIZE).fill().map(() => ({
                    isBomb: false,
                    revealed: false,
                    flagged: false,
                    value: 0
                }))
            );

            // –†–∞—Å—Å—Ç–∞–≤–ª—è–µ–º –±–æ–º–±—ã
            let bombsPlaced = 0;
            while (bombsPlaced < BOMBS_COUNT) {
                const x = Math.floor(Math.random() * BOARD_SIZE);
                const y = Math.floor(Math.random() * BOARD_SIZE);
                
                if (!board[x][y].isBomb) {
                    board[x][y].isBomb = true;
                    bombsPlaced++;
                }
            }

            // –°—á–∏—Ç–∞–µ–º —Å–æ—Å–µ–¥–Ω–∏–µ –±–æ–º–±—ã
            for (let x = 0; x < BOARD_SIZE; x++) {
                for (let y = 0; y < BOARD_SIZE; y++) {
                    if (!board[x][y].isBomb) {
                        let count = 0;
                        for (let dx = -1; dx <= 1; dx++) {
                            for (let dy = -1; dy <= 1; dy++) {
                                const nx = x + dx;
                                const ny = y + dy;
                                if (nx >= 0 && nx < BOARD_SIZE && ny >= 0 && ny < BOARD_SIZE && board[nx][ny].isBomb) {
                                    count++;
                                }
                            }
                        }
                        board[x][y].value = count;
                    }
                }
            }

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            flags = 0;
            seconds = 0;
            flagsEl.textContent = flags;
            timerEl.textContent = seconds;

            // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –ø–æ–ª–µ
            renderBoard();
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–æ–ª—è
        function renderBoard() {
            boardEl.innerHTML = '';
            
            for (let x = 0; x < BOARD_SIZE; x++) {
                for (let y = 0; y < BOARD_SIZE; y++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.x = x;
                    cell.dataset.y = y;

                    if (board[x][y].revealed) {
                        cell.classList.add('revealed');
                        if (board[x][y].isBomb) {
                            cell.classList.add('bomb');
                            cell.textContent = 'üí£';
                        } else if (board[x][y].value > 0) {
                            cell.textContent = board[x][y].value;
                        }
                    } else if (board[x][y].flagged) {
                        cell.textContent = 'üö©';
                    }

                    cell.addEventListener('click', () => handleCellClick(x, y));
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleCellRightClick(x, y);
                    });

                    boardEl.appendChild(cell);
                }
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–ª–µ—Ç–∫–µ
        function handleCellClick(x, y) {
            if (!gameActive || board[x][y].revealed || board[x][y].flagged) return;

            if (!timer) startTimer();

            if (board[x][y].isBomb) {
                // –ü—Ä–æ–∏–≥—Ä—ã—à
                revealAllBombs();
                gameActive = false;
                return;
            }

            revealCell(x, y);
            checkWin();
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∞–≤–æ–≥–æ –∫–ª–∏–∫–∞ (—Ñ–ª–∞–≥)
        function handleCellRightClick(x, y) {
            if (!gameActive || board[x][y].revealed) return;

            board[x][y].flagged = !board[x][y].flagged;
            flags += board[x][y].flagged ? 1 : -1;
            flagsEl.textContent = flags;
            renderBoard();
        }

        // –†–∞—Å–∫—Ä—ã—Ç–∏–µ –∫–ª–µ—Ç–∫–∏
        function revealCell(x, y) {
            if (x < 0 || x >= BOARD_SIZE || y < 0 || y >= BOARD_SIZE || board[x][y].revealed || board[x][y].flagged) {
                return;
            }

            board[x][y].revealed = true;
            renderBoard();

            if (board[x][y].value === 0) {
                // –†–∞—Å–∫—Ä—ã–≤–∞–µ–º —Å–æ—Å–µ–¥–µ–π –¥–ª—è –ø—É—Å—Ç—ã—Ö –∫–ª–µ—Ç–æ–∫
                for (let dx = -1; dx <= 1; dx++) {
                    for (let dy = -1; dy <= 1; dy++) {
                        revealCell(x + dx, y + dy);
                    }
                }
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
        function checkWin() {
            let unrevealedSafeCells = 0;
            
            for (let x = 0; x < BOARD_SIZE; x++) {
                for (let y = 0; y < BOARD_SIZE; y++) {
                    if (!board[x][y].isBomb && !board[x][y].revealed) {
                        unrevealedSafeCells++;
                    }
                }
            }

            if (unrevealedSafeCells === 0) {
                // –ü–æ–±–µ–¥–∞!
                gameActive = false;
                clearInterval(timer);
                alert('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ–±–µ–¥–∏–ª–∏!');
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –±–æ–º–±—ã –ø—Ä–∏ –ø—Ä–æ–∏–≥—Ä—ã—à–µ
        function revealAllBombs() {
            for (let x = 0; x < BOARD_SIZE; x++) {
                for (let y = 0; y < BOARD_SIZE; y++) {
                    if (board[x][y].isBomb) {
                        board[x][y].revealed = true;
                    }
                }
            }
            renderBoard();
            clearInterval(timer);
            alert('–ë–£–ú! –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏');
        }

        // –¢–∞–π–º–µ—Ä
        function startTimer() {
            clearInterval(timer);
            seconds = 0;
            timerEl.textContent = seconds;
            timer = setInterval(() => {
                seconds++;
                timerEl.textContent = seconds;
            }, 1000);
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤
        playBtn.addEventListener('click', () => {
            mainMenu.style.display = 'none';
            gameScreen.style.display = 'block';
            initGame();
            gameActive = true;
        });

        backBtn.addEventListener('click', () => {
            gameScreen.style.display = 'none';
            mainMenu.style.display = 'block';
            clearInterval(timer);
            gameActive = false;
        });
    </script>
</body>
</html>